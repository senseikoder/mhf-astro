---
export const prerender = false;
import BlogPost from "../../layouts/BlogPost.astro";
import placeholder from "../../images/placeholder.png";

const { slug } = Astro.params;
const wpurl = import.meta.env.PUBLIC_WP_URL;

let res = await fetch(
	`${wpurl}/posts?slug=${slug}&_embed`,
   {
    headers: {
      "User-Agent":
        "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",
      "Accept": "application/json",
      "Referer": wpurl,
      "Origin": wpurl
    }
   }
);
if (!res.ok) {
  const text = await res.text();
  console.error(text);
  throw new Error(`WP API error: ${res.status}`);
}
let [post] = await res.json();

post["heroImage"] =
  post._embedded["wp:featuredmedia"] && post._embedded["wp:featuredmedia"]["0"]
    ? post._embedded["wp:featuredmedia"]["0"].source_url
    : placeholder.src; // Adjust the path as necessary
---

<BlogPost {...post}>
	<Fragment set:html={post.content.rendered} />
</BlogPost>
